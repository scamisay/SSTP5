package ar.edu.itba.ss.helper;

import ar.edu.itba.ss.domain.Particle;

import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.nio.file.StandardOpenOption;
import java.util.List;
import java.util.stream.Collectors;

public class Printer {

    private double height;
    private double width;

    private static final String FILE_NAME_OVITO = "ovito.xyz";

    public Printer(double height, double width) {
        this.height = height;
        this.width = width;
        try{
            File file = new File(FILE_NAME_OVITO);

            if (file.exists()) {
                file.delete();
            }
            file.createNewFile();
        }catch (Exception e){
            System.out.println("problemas creando el archivo "+FILE_NAME_OVITO);
        }
    }

    public void printState(double time, List<Particle> particles){
        printForOvito(time, particles);
    }

    private void printForOvito(double time, List<Particle> particles) {
        printStringToFile(FILE_NAME_OVITO, printParticles(time, particles));
    }

    private String printParticles(double time, List<Particle> particles) {
        return (particles.size()+2)+"\n"+
                time + "\n" +
                "0 0 0 0 0 0 0.0001\n"+
                width +" "+height+" 0 0 0 0 0.0001\n"+
                particles.stream()
                        .map(Particle::toString)
                        .collect(Collectors.joining("\n")) +"\n";
    }

    private void printStringToFile(String filename, String content){
        try {
            Files.write(Paths.get(filename), content.getBytes(), StandardOpenOption.APPEND);
        } catch (IOException e) {
            try {
                new File(filename).createNewFile();
                Files.write(Paths.get(filename), content.getBytes(), StandardOpenOption.APPEND);
            } catch (IOException e1) {
                System.out.println("No se pudo crear el archivo "+filename);
            }
        }
    }

}
